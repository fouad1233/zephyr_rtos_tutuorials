/*
 * Copyright (c) 2017 Bobby Noelte
 *
 * SPDX-License-Identifier: Apache-2.0
 */

 /dts-v1/;
 #include "stm32f091cc.dtsi"
 #include <st/f0/stm32f091c(b-c)tx-pinctrl.dtsi>
 #include "arduino_r3_connector.dtsi"
 #include "st_morpho_connector.dtsi"
 #include <zephyr/dt-bindings/input/input-event-codes.h>
 
 / {
     model = "STMicroelectronics STM32F091RC-NUCLEO board";
     compatible = "barth,stg_800";
 
     chosen {
         zephyr,shell-uart = &usart2;
         zephyr,sram = &sram0;
         zephyr,flash = &flash0;
         zephyr,canbus = &can1;
     };
 
     leds: leds {
         status = "okay";
         compatible = "gpio-leds";
         green_led: green_led {
             status = "okay";
             gpios = <&gpioa 8 GPIO_ACTIVE_HIGH>;
             label = "User LD";
         };
     };
 
     gpio_keys {
        status = "okay";
        compatible = "gpio-keys";
        mcuboot_button0: button_0 {
            status = "okay";
            label = "SW1";
            gpios = <&gpioa 12 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>; //In 4
            zephyr,code = <INPUT_KEY_0>;
        };
        

    };

    buttons {
        status = "okay";
        compatible = "gpio-keys";
        button1: button_1 {
            status = "okay";
            gpios = <&gpioa 1 GPIO_ACTIVE_HIGH>;
        };
    };
 
     pwmleds: pwmleds {
         compatible = "pwm-leds";
         /* NOTE: disabled by default, PWM2 conflicts with SPI1 */
         status = "disabled";
 
         green_pwm_led: green_pwm_led {
             pwms = <&pwm2 1 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
         };
     };
 
     aliases {
         led0 = &green_led;
         sw0 = &mcuboot_button0;
         pwm-led0 = &green_pwm_led;
         watchdog0 = &iwdg;
         die-temp0 = &die_temp;
         volt-sensor0 = &vref;
         volt-sensor1 = &vbat;
         mcuboot-button0 = &mcuboot_button0;   
     };
 };
 
 
 
 &clk_hsi {
     status = "okay";
     
 };
 &clk_lsi {
     status = "okay";
 };
 
 &pll {
     prediv = <1>;
     mul = <6>;
     clocks = <&clk_hsi>;
     status = "okay";
 };
 
 &rcc {
     clocks = <&pll>;
     clock-frequency = <DT_FREQ_M(48)>;
     ahb-prescaler = <1>;
     apb1-prescaler = <1>;
 };
 
 &usart1 {
     pinctrl-0 = <&usart1_tx_pa9 &usart1_rx_pa10>;
     pinctrl-names = "default";
     current-speed = <115200>;
     status = "okay";
     
 };
 
 &usart2 {
     pinctrl-0 = <&usart2_tx_pa2 &usart2_rx_pa3>;
     pinctrl-names = "default";
     current-speed = <115200>;
     status = "okay";
 };
 
 &i2c1 {
     pinctrl-0 = <&i2c1_scl_pb8 &i2c1_sda_pb9>;
     pinctrl-names = "default";
     status = "okay";
     clock-frequency = <I2C_BITRATE_FAST>;
 };
 
 &i2c2 {
     /* Pin conflict with can1. Enable only with can1 disabled. */
     pinctrl-0 = <&i2c2_scl_pa11 &i2c2_sda_pa12>;
     pinctrl-names = "default";
     status = "disabled";
     clock-frequency = <I2C_BITRATE_FAST>;
 };
 
 &can1 {
     pinctrl-0 = <&can_rx_pa11 &can_tx_pa12>;
     pinctrl-names = "default";
     status = "okay";
 };
 
 &spi1 {
     pinctrl-0 = <&spi1_sck_pa5 &spi1_miso_pa6 &spi1_mosi_pa7>;
     pinctrl-names = "default";
     status = "okay";
 };
 
 &spi2 {
     pinctrl-0 = <&spi2_sck_pb13 &spi2_miso_pb14 &spi2_mosi_pb15>;
     pinctrl-names = "default";
     status = "okay";
 };
 
 &iwdg {
     status = "okay";
 };
 
 &rtc {
     clocks = <&rcc STM32_CLOCK_BUS_APB1 0x10000000>,
          <&rcc STM32_SRC_LSI RTC_SEL(2)>;
     status = "okay";
 };
 
 
 
 &adc1 {
     pinctrl-0 = <&adc_in0_pa0>;
     pinctrl-names = "default";
     st,adc-clock-source = <SYNC>;
     st,adc-prescaler = <4>;
     status = "okay";
 };
 
 &die_temp {
     status = "okay";
 };
 
 &dac1 {
     status = "okay";
     pinctrl-0 = <&dac_out1_pa4>;
     pinctrl-names = "default";
 };
 
 &dma1 {
     status = "okay";
 };
 
 &timers2 {
     st,prescaler = <10000>;
     status = "okay";
 
     pwm2: pwm {
         /* NOTE: disabled by default, PWM2 conflicts with SPI1 */
         pinctrl-0 = <&tim2_ch1_pa5>;
         pinctrl-names = "default";
     };
 };
 
 &vref {
     status = "okay";
 };
 
 &vbat {
     status = "okay";
 };

 &flash0 {
    partitions {
        compatible = "fixed-partitions";
        #address-cells = <1>;
        #size-cells = <1>;

        boot_partition: partition@0 {
            label = "mcuboot";
            reg = <0x00000000 0x00010000>; /* 64 KB */
        };

        slot0_partition: partition@10000 {
            label = "image-0";
            reg = <0x00010000 0x00018000>; /* 96 KB */
        };

        slot1_partition: partition@20000 {
            label = "image-1";
            reg = <0x00020000 0x00018000>; /* 96 KB */
        };

        storage_partition: partition@38000 {
            label = "storage";
            reg = <0x00038000 0x00008000>; /* 32 KB */
        };
    };
};


 /{
    chosen {
            zephyr,code-partition = &slot0_partition; 
            zephyr,console = &usart1;
            
        };
    };


 